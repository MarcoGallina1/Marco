<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_invoice_document">
            <t t-call="web.basic_layout">
                <t t-foreach="docs" t-as="o">
                    <t>
                        <div class="page">
                            <div class="oe_structure"/>
                            <div class="col-12" style="text-align:left;">
                                <span>CUIT: </span> <span t-field="o.company_id.vat"/>

                                <span>IIBB: </span> <span t-field="o.company_id.iibb_number"/>

                                <span>FECHA INICIO ACTIVIDADES: </span> <span t-field="o.company_id.start_date"/>

                                <span t-field="o.company_id.account_position_id"/>
                            </div>

                            <p>
                            <hr/>
                            </p>


                        <div>
                            <p t-field="o.invoice_date"/>
                        </div>

                            <!-- HORA -->
                            <table align="left" width="100%">
                                <td style="text-align:left;">
                                    <span>CAJA: </span>
                                    <span t-field="o.pos_ar_id"/>
                                </td>
                                <td style="text-align:left;">
                                    <span>CAJERO: </span>
                                    <span t-field="o.invoice_user_id"/>
                                </td>

                               </table>

                            <hr/>
                            <hr/>
                            <hr/>


                         <h2>
                                <span t-if="o.type == 'out_invoice' and o.state == 'posted'">Factura</span>
                                <span t-if="o.type == 'out_invoice' and o.state == 'draft'">Factura Borrador</span>
                                <span t-if="o.type == 'out_invoice' and o.state == 'cancel'">Factura Cancelada</span>
                                <span t-if="o.type == 'out_refund'">Nota de Crédito</span>
                                <span t-if="o.type == 'in_refund'">Nota de Crédito Proveedor</span>
                                <span t-if="o.type == 'in_invoice'">Factura Compra B (COPIA CLIENTE)</span>
                            </h2>

                         <hr/>

                        <div class="col-12" style="text-align:left;">
                                <span>PUNTO DE VENTA: </span> <span t-field="o.pos_ar_id"/>
                            </div>

                        <div class="col-12" style="text-align:left;">
                                <span> FACTURA NR: </span> <span t-field="o.name"/>
                            </div>
                        <table cellspacing="0" cellpadding="0" width="90%">
                           <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                             <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                              <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                                 <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                                 <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                                 <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                                 <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                                 <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                                 <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                                 <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                                 <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                                 <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                                 <td style="text-align:left;">
                                    <span>  </span>
                                 </td>
                                <td style="text-align:left;">
                                    <span>CAE NR: </span>
                                    <span t-field="o.cae"/>
                                </td>
                             <td style="text-align:left;">
                                    <span>VTO: </span>
                                    <span t-field="o.cae_due_date"/>
                                </td>
                        </table>


                        <hr/>


                                        <t t-set="display_discount" t-value="any(l.discount for l in o.invoice_line_ids)"/>
                        <t t-set="has_internal" t-value="any(group == env.ref('l10n_ar.tax_group_internal') for group in o.line_ids.mapped('tax_line_id'))"/>
                        <table class="table table-sm o_main_table">
                            <thead>
                                <tr>
                                    <t t-set="colspan" t-value="6"/>
                                    <th class="text-left">DESCRIPCIÓN</th>
                                    <th class="text-right">CANTIDAD</th>
                                    <th class="text-right">PRECIO UNITARIO</th>
                                    <th t-if="display_discount" class="text-right">
                                        <span>DISC %</span>
                                        <t t-set="colspan" t-value="colspan+1"/>
                                    </th>
                                    <t t-if="o.voucher_type_id.denomination_id.vat_discriminated">
                                        <th class="text-right">SUBTOTAL</th>
                                        <th class="text-right">VAT</th>
                                        <t t-if="has_internal">
                                            <th class="text-right">INTERNAL</th>
                                        </t>
                                    </t>
                                    <th class="text-right">TOTAL</th>
                                </tr>
                            </thead>
                            <tbody class="sale_tbody">
                                <t t-set="current_total" t-value="0"/>
                                <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                                <t t-foreach="lines" t-as="line">
                                    <!--VARIABLES-->
                                    <t t-set="line_total" t-value="line.price_total"/>
                                    <t t-set="total_discount" t-value="1 - (line.discount or 0.0) / 100.0"/>
                                    <t t-set="price_with_vat_discriminated" t-value="line.price_subtotal/line.quantity / total_discount if total_discount and line.quantity else 0.0"/>
                                    <t t-set="price" t-value="line.price_total/line.quantity / total_discount if total_discount and line.quantity else 0.0"/>

                                    <t t-if="o.voucher_type_id.denomination_id.vat_discriminated">
                                        <t t-set="price_unit" t-value="price_with_vat_discriminated"/>
                                    </t>
                                    <t t-if="not o.voucher_type_id.denomination_id.vat_discriminated">
                                        <t t-set="price_unit" t-value="price"/>
                                    </t>
                                    <t t-set="current_total" t-value="current_total + line_total"/>

                                    <!--LINEAS DE FACTURA-->
                                    <tr t-att-class="'bg-200 font-weight-bold o_line_section'                                 if line.display_type == 'line_section' else 'font-italic o_line_note'                                 if line.display_type == 'line_note' else ''">
                                        <t t-if="not line.display_type">
                                            <td><span t-field="line.name"/></td>
                                            <td class="text-right">
                                                <span t-field="line.quantity"/>
                                                <span t-field="line.product_uom_id.name" groups="uom.group_uom"/>
                                            </td>
                                            <td class="text-right">
                                                <span t-esc="price_unit" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                            </td>
                                            <td t-if="display_discount" class="text-right">
                                                <span t-field="line.discount"/>
                                            </td>
                                            <t t-if="o.voucher_type_id.denomination_id.vat_discriminated">
                                                <td class="text-right">
                                                    <span t-field="line.price_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                                </td>
                                                <td class="text-right">
                                                    <span t-esc="', '.join([ str(tax.amount)+'%' for tax in                                     line.tax_ids if tax.is_vat])"/>
                                                </td>
                                                <t t-if="has_internal">
                                                    <td class="text-right">
                                                        <span t-esc="', '.join([ str(tax.description) for tax in                                     line.tax_ids.filtered(lambda x: x.tax_group_id == env.ref('l10n_ar.tax_group_internal'))])"/>
                                                    </td>
                                                </t>
                                            </t>
                                            <td class="text-right o_price_total">
                                                <span t-esc="line_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                            </td>
                                        </t>
                                        <t t-if="line.display_type == 'line_section'">
                                            <td t-att-colspan="colspan">
                                                <span t-field="line.name"/>
                                            </td>
                                            <t t-set="current_section" t-value="line"/>
                                            <t t-set="current_total" t-value="0"/>
                                        </t>
                                        <t t-if="line.display_type == 'line_note'">
                                            <td t-att-colspan="colspan">
                                                <span t-field="line.name"/>
                                            </td>
                                        </t>
                                    </tr>

                                    <t t-if="current_section and (line_last or lines[line_index+1].display_type == 'line_section')">
                                        <tr class="is-subtotal text-right">
                                            <td t-att-colspan="colspan">
                                                <strong class="mr16">Total</strong>
                                                <span t-esc="current_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
                                            </td>
                                        </tr>
                                    </t>

                                </t>
                            </tbody>
                        </table>


                             <tr class="border-black o_total">
                                                <td><strong>TOTAL: </strong></td>
                                                <td class="text-right">
                                                    <span class="text-nowrap" t-field="o.amount_total"/>
                                                </td>
                                            </tr>

                            <hr style="border: 1px dashed black;" />

                            <!-- MÉTODO DE PAGO -->

                            <!-- PESOS RECIBIDO Y VUELTO -->

                            <hr/>

                            <i>Grazie per aver acquistato!!!!</i>

                            <hr/>

                            <p>Tuviste algun problema? Tu opinión nos interesa:</p>

                            <!-- ÍCONO MAIL  --> <p>ciao@frescalapasta.com</p>

                            <!-- ÍCONO WHATSAPP  --> <p>11-237-5416 / 11-773-1188</p>


                            <hr/>

                            <p>No te olvides seguir al pie de la letra nuestros consejos de cocción.
        Encontrá los videos explicativos en el codigo QR que se encuentra
        en la tapa de nuestros packs.</p>

                            <!-- CÓDIGO QR -->

                            <p>O si no acercá el lector a este codigo.</p>
                            <hr/>
                            <p t-field="o.company_id.website"/>
                            <p>ATENCION TELEFONICA: 11-774-3122</p>
                        </div>
                    </t>
                </t>
            </t>
        </template>

        <template id="report_invoice">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <t t-set="lang" t-value="o.invoice_user_id.sudo().lang if o.type in ('in_invoice', 'in_refund') else o.partner_id.lang"/>
                    <t t-call="fl_ticket_print.report_invoice_document" t-lang="lang"/>
                </t>
            </t>
        </template>

        <report
            id="account_invoices_without_payment"
            model="account.move"
            string="Fresca Invoices"
            report_type="qweb-pdf"
            name="fl_ticket_print.report_invoice"
            file="fl_ticket_print.report_invoice"
            attachment="(object.state == 'posted') and ((object.name or 'INV').replace('/','_')+'.pdf')"
            print_report_name="(object._get_report_base_filename())"
        />

    </data>
</odoo>
